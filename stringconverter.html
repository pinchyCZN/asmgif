<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<title>Text -> C/C++ string converter</title>  
</head>
<body>

<div id="wrap">
<div id="header">


     

<script type="text/javascript">

function insertAtCursor(myField, myValue) {
	//IE support
	if (document.selection) {
		myField.focus();
		sel = document.selection.createRange();
		sel.text = myValue;
	}

	//MOZILLA/NETSCAPE support
	else if (myField.selectionStart || myField.selectionStart == '0') {
		var startPos = myField.selectionStart;
		var endPos = myField.selectionEnd;
		restoreTop = myField.scrollTop;

		myField.value = myField.value.substring(0, startPos) + myValue + myField.value.substring(endPos, myField.value.length);

		myField.selectionStart = startPos + myValue.length;
		myField.selectionEnd = startPos + myValue.length;

		if (restoreTop > 0) {
			myField.scrollTop = restoreTop;
		}
	} else {
		myField.value += myValue;
	}
}

function interceptTabs(evt, control) {
	key = evt.keyCode ? evt.keyCode : evt.which ? evt.which : evt.charCode;
	if (key == 9) {
		insertAtCursor(control, '\t');
		return false;
	} else {
		return key;
	}
}

function iswhite(c){
	if(c==' ' || c=='\t' || c=='\r' || c=='\n')
		return true;
	else
		return false;
}
function isalpha(c){
	if(c>='a' && c<='z')
		return true;
	else if(c>='A' && c<='Z')
		return true;
	else
		return false;
}
function cstr_encode(input) {
	var output = "";
	var linecomment = false;
	var blockcomment = false;
	var skip = false;
	var lastchar='';
	for (i = 0; i < input.length; i++) {
		var c=input[i];
		skip=true;
		switch (c) {
			case '\n':
			case '\r':
				linecomment=false;
				break;
			case '/':
				skip=false;
				if(blockcomment){
					if(input[i-1]=='*'){
						blockcomment=false;
						skip=true;
					}
				}
				else if (i < input.length - 1) {
					if(input[i+1]=='/')
						linecomment=true;
					else if(input[i+1]=='*')
						blockcomment=true;
				}
				break;
			case '\t':
				if(i==0)
					break;
				else if(i>0){
					if(iswhite(input[i-1]))
						break;
				}
				c=' ';
			case ' ':
				if (i > 0 && ( input[i - 1] == ';' 
							|| input[i - 1] == ')')
							) {
					break;
				} else if (i < input.length - 1) {
					if (iswhite(input[i + 1])){
						break;
					}
				} else if (i == input.length - 1) {
					break;
				}
				skip=false;
				break;
			default:
				skip=false;
				if(i>0){
					if(input[i-1]=='\r' || input[i-1]=='\n'){
						if(isalpha(c) && isalpha(lastchar)){
							if(!blockcomment)
								if(!linecomment)
									output+=' ';
						}
					}
				}
				break;
		}
		if(!blockcomment)
			if(!linecomment)
				if(!skip){
					output += c;
					lastchar=c;
				}
	}
	return output;
}

function Convert() {
	var output = cstr_encode(document.frmConvert.ed_input.value);
	document.frmConvert.ed_output.value = output;
	var gifstr='!gif '+output;
	document.frmConvert.gif_output.value = gifstr;
	document.getElementById('stringlen').innerHTML=gifstr.length;
}

</script>

<div id="main">
	<h3>Text -> C/C++ string converter</h3>
	<form name="frmConvert" action="">
		<p>Source text:</p>
		<!--onkeydown="return interceptTabs(event, this);" -->
		<p><textarea name="ed_input" rows="10" cols="67" style="width: 550px;"></textarea></p>
		<p>
			<button type=button name="btnConvert"
				onclick="Convert()">
			Convert
			</button>
		</p>
		<p>C/C++ string</p>
		<p>
			<textarea name="ed_output" rows="10" cols="67" style="width: 550px;"></textarea>          
		</p>
		<p>gif string</p>
		<p>
			<textarea name="gif_output" rows="10" cols="67" style="width: 550px;"></textarea>          
		</p>
		<span>Length=</span><span id="stringlen"></span>
	</form>
</div>

</body>
</html>

